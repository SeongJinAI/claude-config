#!/bin/bash

# Commit-msg 훅
# 커밋 메시지 형식을 검사합니다.

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

echo "📝 커밋 메시지 검사..."

# 최소 길이 검사
MIN_LENGTH=10
if [ ${#COMMIT_MSG} -lt $MIN_LENGTH ]; then
    echo "❌ 커밋 메시지가 너무 짧습니다. (최소 ${MIN_LENGTH}자)"
    exit 1
fi

# Conventional Commits 형식 검사 (선택적)
# 형식: type(scope): description
# 예: feat(auth): 로그인 기능 추가

CONVENTIONAL_PATTERN="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .+"

# 한글 커밋 메시지도 허용
KOREAN_PATTERN="^.{10,}"

if [[ $COMMIT_MSG =~ $CONVENTIONAL_PATTERN ]]; then
    echo "✓ Conventional Commits 형식"
elif [[ $COMMIT_MSG =~ $KOREAN_PATTERN ]]; then
    echo "✓ 일반 커밋 메시지"
else
    echo "⚠️  권장 커밋 메시지 형식:"
    echo "   - Conventional: feat(scope): 설명"
    echo "   - 일반: 최소 10자 이상"
    # 경고만 표시, 차단하지 않음
fi

# WIP 커밋 경고
if [[ $COMMIT_MSG =~ ^(WIP|wip|Wip) ]]; then
    echo "⚠️  WIP 커밋입니다. 푸시 전에 squash를 고려하세요."
fi

echo "✅ 커밋 메시지 검사 완료!"
exit 0
